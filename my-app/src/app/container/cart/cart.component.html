<div class="main">
  <div class="page-title">Review your order</div>

  <div class="checkout-grid">
    <div class="order-summary js-order-summary">
      <div class="cart-item-container" *ngFor="let item of cart.items">
        <div class="delivery-date">
          {{ deliveryDate[item.product.id] }}
        </div>

        <div class="cart-item-details-grid">
          <img [src]="(item.product.image_url && item.product.image_url.length > 0) ? (staticUrl + 'images/products/' + item.product.image_url) : 'https://via.placeholder.com/150'" class="product-image">

          <div class="cart-item-details">
            <div class="product-name">
              {{ item.product.name }}
            </div>
            <div class="product-price">
              ${{ formatCurrency(item.product.price) }}
            </div>

            <!-- <div class="product-quantity">
              <ng-container *ngIf="!(isEditingQuantity[item.product.id] === true); else editMode">
                Quantity: <span class="quantity-label">{{ item.quantity }}</span>
                <span class="update-quantity-link link-primary" (click)="showEditItemQuantityForm(item.product.id)">
                  Update
                </span>
              </ng-container>
              <ng-template #editMode>
                <input
                  type="number"
                  min="1"
                  class="quantity-input"
                  [(ngModel)]="selectedItem[item.product.id].quantity"
                >
                <span class="save-quantity-link link-primary" (click)="updateCartItemQuantity(item.product.id, selectedItem[item.product.id].quantity)">
                  Save
                </span>
              </ng-template>
              <span *ngIf="isEditingQuantity[item.product.id] === false" class="delete-quantity-link link-primary" (click)="removeFromCart(item.product)">
                Delete
              </span>
            </div> -->

            <div class="product-quantity">
              <div *ngIf="!(isEditingQuantity[item.product.id] === true)">
                <span>
                  Quantity: <span class="quantity-label">{{ item.quantity }}</span>
                </span>
                <span class="update-quantity-link link-primary" (click)="showEditItemQuantityForm(item.product.id)">
                  Update
                </span>
                <span class="delete-quantity-link link-primary" (click)="removeFromCart(item.product)">
                  Delete
                </span>
              </div>

              <div *ngIf="isEditingQuantity[item.product.id] === true">
                <input
                type="number" min="1"
                class="quantity-input"
                [(ngModel)]="selectedItem[item.product.id].quantity"
                >
                <span
                  class="save-quantity-link link-primary"
                  (click)="updateCartItemQuantity(item.product.id, selectedItem[item.product.id].quantity)"
                  >
                  Save
                </span>
              </div>
            </div>
          </div>

          <div class="delivery-options">
            <div class="delivery-options-title">
              Choose a delivery option:
            </div>
            <div class="delivery-option">
              <input type="radio" checked
                class="delivery-option-input"
                name="delivery-option-{{ item.product.id }}"
                value="date:{{ deliveryDate3 }},cost: 0"
                (click)="setDeliveryDate(item.product.id, 7, 0)"
              >
              <div>
                <div class="delivery-option-date">
                  {{ deliveryDate3 }}
                </div>
                <div class="delivery-option-price">
                  FREE Shipping
                </div>
              </div>
            </div>
            <div class="delivery-option">
              <input type="radio"
                class="delivery-option-input"
                name="delivery-option-{{ item.product.id }}"
                value="date:{{ deliveryDate2 }},cost:5"
                (click)="setDeliveryDate(item.product.id, 3, 5)"
              >
              <div>
                <div class="delivery-option-date">
                  {{ deliveryDate2 }}
                </div>
                <div class="delivery-option-price">
                  $5 - Shipping
                </div>
              </div>
            </div>
            <div class="delivery-option">
              <input type="radio"
                class="delivery-option-input"
                name="delivery-option-{{ item.product.id }}"
                value="date:{{ deliveryDate1 }},cost:9.99"
                (click)="setDeliveryDate(item.product.id, 1, 10)"
              >
              <div>
                <div class="delivery-option-date">
                  {{ deliveryDate1 }}
                </div>
                <div class="delivery-option-price">
                  $10 - Shipping
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="payment-summary">
      <div class="payment-summary-title">
        Order Summary
        </div>

        <div class="payment-summary-row">
        <div class="js-items-quantity">Items ({{ totalCartItems }}):</div>
        <div class="payment-summary-money">${{ formatCurrency(totalCartCost) }}</div>
        </div>

        <div class="payment-summary-row">
          <div>Shipping &amp; handling:</div>
          <div class="payment-summary-money">${{ formatCurrency(totalShiping) }}</div>
        </div>

        <div class="payment-summary-row subtotal-row">
          <div>Total before tax:</div>
          <div class="payment-summary-money">
            ${{ formatCurrency(totalCartCost + totalShiping) }}
          </div>
        </div>

        <div class="payment-summary-row">
          <div>Estimated tax (10%):</div>
          <div class="payment-summary-money">
            ${{ formatCurrency((totalCartCost + totalShiping) * 0.1) }}
          </div>
        </div>

        <div class="payment-summary-row total-row">
          <div>Order total:</div>
            <div class="payment-summary-money">
              ${{ formatCurrency((totalCartCost + totalShiping) * 1.1) }}
            </div>
          </div>

        <button class="place-order-button button-primary"> Place your order </button>
    </div>
  </div>
</div>
